<!doctype html>
<html lang="ko">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Document</title>
    </head>
    <body>
        <script>
            // API: Application Programming Interface
            // 하나의 규격
            // 양영디지털고등학교 기능반과 선생님은 대화를 디스코드로 한다.
            // => 디스코드로 대화를 하는데, 무조건 대화 시작할 때 안녕하세요로 한다.

            // 완전 옛날 초창기

            // HTML, CSS 내껏만 있었어요.
            // 지금 웹 사이트: 로그인, 회원가입 (DB)

            // 어..? 이거 HTML, CSS, JS, PHP(Java) 이건

            // Ajax: 통신하는 기술 (핸드폰)
            // API: 데이터를 주고 받는 규칙 (카카오톡, 디스코드)

            // 1. callback 지옥
            // 비동기 함수를 사용하려면
            // 무슨 문제냐?
            // 코드 읽기가 어려워요. 가독성이 떨어진다.
            // 관리가 어렵다.
            // 의존적이다.
            // 너무 자유도가 높다. -> 우리가 변수(파라미터)명을 마음대로 지을 수 있어서 뭔가 규칙이 없다.

            // 2. promise 등장
            // callback 함수에 대한 규칙을 만들자.
            // 사용할 때: 함수 안에서 return new Promise
            // resolve: 성공
            // reject: 실패
            function fetchLoginUser2() {
                // resolve : 성공
                // reject : 실패
                return new Promise((resolve, reject) => {
                    if (id === 1) {
                        resolve();
                    } else {
                        reject();
                    }
                });
            }
            // 또 의문: 어..? callback 지옥은 여전하지 않나요?
            // promise 왜 나왔냐? 규칙이 없으니까
            // fetchLoginUser2()
            //.then(() => {
            //    console.log("성공");
            //})
            //.catch(() => {
            //    console.log("실패");
            //});

            fetch("https://jsonplaceholder.typicode.com/comments")
                .then((res) => {
                    console.log(res);
                })
                .catch(() => {
                    console.log("에러");
                });

            // 3. async & await의 등장
            // async:
            //  - 사용만 해도 비동기 함수로 만들어요.
            //  - 함수 앞에 사용한다.
            //  - async 함수에서는 await을 사용할 수 있다.
            // await:
            //  - 비동기 함수를 동기로 만든다.

            let users;

            // fetch("https://jsonplaceholder.typicode.com/users")
            //     .then((res) => res.json())
            //     .then((res) => {
            //         users = res;
            //         console.log(users);
            //     });
            async function setUsers() {
                const response = await fetch("https://jsonplaceholder.typicode.com/users");
                const users = await response.json();

                console.log(users);
            }

            setUsers();
            // 1. await은 async 안에서만 사용할 수 있다.
            // 2. await은 최상단 레벨(완전 밖)에서 사용할 수 없다.
            // 3. async 함수 혹은 Promise 함수를 그냥 사용하면 비동기다.
            // 4. 비동기 함수(sync, promise)는 변수에 할당할 수 없다. (await 사용 안 하면)
            // 5. await은 비동기 함수에만 사용할 수 있다.

            // 동기 함수? => if, for, 변수 선언, console.log 등등 웬만한 애들 전부
            // 비동기 함수? => setTimeout, setInterval, fetch, promise

            async function sleep(ms) {
                return new Promise((res, rej) => {});
            }

            async function start() {
                await sleep(500);
                console.log("0.5초 쉬고");
                await sleep(1000);
                console.log("1초 쉬고");
                await sleep(2000);
                console.log("2초 쉬고");
            }
            start();
        </script>
    </body>
</html>
